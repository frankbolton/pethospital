<!DOCTYPE html>

<html>
    <head>
        <meta charset="utf-8"/>
        <title>Pethospital Task</title>
        <link rel="stylesheet" href="pethospital.css"/>
    </head>
  
    <body>
       
        <section id="test_pet_area">

        </section>


        <script src="pethospital.js"></script>
        <script src="myStation.js"></script>
        <script src="logEvents.js"></script>
        <script src="gameScore.js"></script>
        
        <script type="text/javascript">

            //parts to replace using templating from Flask
            //var id = -1;
            //logEvents.setParticipantID({{id}});

            var station = [];
            //(start health / health delta / noise / name / pos_h / pos_w / handle to gameScrore)
            

            station[0] = new myStation(100, 10, 0, "Tinky", 60, 50, gameScore);
            station[1] = new myStation(100, 4, 1, "Dinky", 60, 350, gameScore);
            station[2] = new myStation(100, 4, 1, "Loony", 60, 650, gameScore);
            station[3] = new myStation(100, 10, 1, "Shoony",360,50, gameScore);
            station[4] = new myStation(100, 4, 1, "Zoomy", 360, 350, gameScore);
            station[5] = new myStation(100, 10, 1, "Timmy", 360, 650, gameScore);


            //var scores = new gameScore();

            gameScore.setDuration(60);
            gameScore.setScoreDeltas(1,1,1);

            var previousTime = 0;
            var previousMod = 999;
            var startTime = Date.now();
            var currentTime = 0;
            var currentMod = 0;


            function drawScreen() {
                currentTime = Date.now();
//                if ((currentTime - previousTime ) > 1000)
                currentMod = currentTime % 1000;
                //console.log("the current mod is" + currentMod + " and the previous mod is " + previousMod);
                if (currentMod < previousMod)
                {
                    var allOK = true;
                    gameScore.tick();
                    for (i in station)  {
                        station[i].decrement();
                        allOK = allOK + station[i].OK();
                    }
                    if (allOK) {
                        gameScore.inc();
                        
                    }
                    previousTime = currentTime;
                }

                previousMod = currentMod;
            }

            function gameLoop() {
                window.setTimeout(gameLoop, 100);
                drawScreen();
            }

            gameLoop();

        </script>
    </body>
</html>